<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Widget Viagens ‚Äì Completo</title>
<style>
    .country-flag{width:18px;height:14px;object-fit:cover;border-radius:2px;margin-left:6px;}
    body { font-family: Arial, sans-serif; background: #0d0d0d; color: #ffffff; padding: 25px; }
    #next-destination { background: #1f1f1f; border: 1px solid #333; padding: 12px 16px; border-radius: 10px; margin-bottom: 18px; font-size: 1.05rem; text-align: center; }
    #trips-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; width: 100%; }
    .trip-card { background: #141414; border: 1px solid #262626; border-radius: 12px; padding: 14px; box-shadow: 0 0 8px rgba(0,0,0,0.6); text-align: left; display:flex; flex-direction:column; gap:8px; }
    .title-row { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .title-row h3 { margin:0; font-size:1rem; display:flex; align-items:center; gap:6px; }
    .date-info { color:#27ae60; font-size:.88rem; }
    .progress-wrapper { position:relative; height:26px; background:#222; border-radius:20px; overflow:visible; margin-top:6px; }
    .progress-fill { position:absolute; left:0; top:0; height:100%; width:0%; transition: width .6s linear, background .3s linear; }
    .progress-percent { position:absolute; right:8px; top:50%; transform:translateY(-50%); font-size:.78rem; font-weight:600; color:#27ae60; text-shadow:0 1px 2px rgba(0,0,0,0.6); }
    .emoji-icon { position:absolute; top:50%; transform:translateY(-50%); font-size:20px; transition: left .5s ease, transform .25s ease; }
    .emoji-jump { animation: jump .6s infinite alternate; }
    @keyframes jump { from { transform: translateY(-50%); } to { transform: translateY(-80%); } }
    .status { color:#e6e6e6; font-weight:600; font-size:.9rem; }
    .sub { color:#bdbdbd; font-size:.82rem; }

    /* Timeline (markers only - no fill bar) */
    #timeline { margin-top:20px; padding:14px; background:#121212; border-radius:10px; border:1px solid #2b2b2b; }
    .timeline-bar { height:14px; background:transparent; border-radius:8px; position:relative; overflow:visible; }
    .tl-marker { position:absolute; top:0; font-size:13px; color:#bdbdbd; transform:translateX(-50%); white-space:nowrap; display:flex; align-items:center; gap:6px; }
</style>
</head>
<body>

<div id="next-destination">Pr√≥ximo destino: carregando...</div>
<div id="trips-container"></div>

<!-- timeline bar placeholder (necess√°rio para o script) -->
<div id="timelineBar" style="display:none"></div>


    
  </div>
</div>

<script>
const FLAGS = {
    'Guarulhos': 'https://flagcdn.com/w20/br.png',
    'Lisboa': 'https://flagcdn.com/w20/pt.png',
    'Madri': 'https://flagcdn.com/w20/es.png',
    'Paris': 'https://flagcdn.com/w20/fr.png',
    'Londres': 'https://flagcdn.com/w20/gb.png',
    'Roma': 'https://flagcdn.com/w20/it.png',
    'Civitavecchia': 'https://flagcdn.com/w20/it.png',
    'Val√™ncia': 'https://flagcdn.com/w20/es.png',
    'Barcelona': 'https://flagcdn.com/w20/es.png',
    'Marselha': 'https://flagcdn.com/w20/fr.png',
    'G√™nova': 'https://flagcdn.com/w20/it.png',
    'Livorno': 'https://flagcdn.com/w20/it.png'
};

function cleanLocation(raw){
    return raw
        .replace(/[‚òÄ-‚ûø]/g, '')
        .replace(/[()]/g, '')
        .replace(/‚Äì.*/g, '')
        .trim();
}
function getOriginDest(title){
    if(title.includes('‚Üí')){
        const parts = title.split('‚Üí').map(p=>cleanLocation(p));
        return { from: parts[0].trim(), to: parts[1].trim() };
    }
    const single = cleanLocation(title);
    return { from: single, to: single };
}
function flagForUrl(loc){ return FLAGS[loc] || null; }

const TRIPS = [
    { title: "Guarulhos ‚Üí Lisboa", emoji: "‚úàÔ∏è", date: "2025-12-19T16:20:00", arrival: "05:15", type: "flight" },
    { title: "Lisboa ‚Üí Madri", emoji: "‚úàÔ∏è", date: "2025-12-23T18:00:00", arrival: "20:20", type: "flight" },
    { title: "Madri ‚Üí Paris", emoji: "‚úàÔ∏è", date: "2025-12-27T14:25:00", arrival: "16:30", type: "flight" },
    { title: "Paris ‚Üí Londres", emoji: "üöÑ", date: "2026-01-02T16:12:00", arrival: "17:30", type: "train" },
    { title: "Londres ‚Üí Roma", emoji: "‚úàÔ∏è", date: "2026-01-08T16:40:00", arrival: "22:40", scale: "Escala em Mil√£o (19:30‚Äì21:30)", type: "flight" },
    { title: "Civitavecchia", emoji: "üö¢", date: "2026-01-15T11:00:00", embark: "11:00", depart: "2026-01-15T19:00:00", type: "cruise-start" },
    { title: "Val√™ncia", emoji: "üõ≥Ô∏è", date: "2026-01-17T07:00:00", type: "cruise-stop", depart: "2026-01-17T21:00:00" },
    { title: "Barcelona", emoji: "üõ≥Ô∏è", date: "2026-01-18T08:00:00", type: "cruise-stop", depart: "2026-01-18T18:00:00" },
    { title: "Marselha", emoji: "üõ≥Ô∏è", date: "2026-01-19T08:00:00", type: "cruise-stop", depart: "2026-01-19T18:00:00" },
    { title: "G√™nova", emoji: "üõ≥Ô∏è", date: "2026-01-20T08:00:00", type: "cruise-stop", depart: "2026-01-20T19:00:00" },
    { title: "Livorno", emoji: "üõ≥Ô∏è", date: "2026-01-21T07:00:00", type: "cruise-stop", depart: "2026-01-21T20:00:00" },
    { title: "Civitavecchia", emoji: "üö¢", date: "2026-01-22T07:00:00", arrival: "07:00", type: "cruise-end" },
    { title: "Roma ‚Üí Madri", emoji: "‚úàÔ∏è", date: "2026-01-22T14:45:00", arrival: "17:20", type: "flight" },
    { title: "Madri ‚Üí Lisboa", emoji: "‚úàÔ∏è", date: "2026-01-22T21:10:00", arrival: "21:35", type: "flight" },
    { title: "Lisboa ‚Üí Guarulhos", emoji: "‚úàÔ∏è", date: "2026-01-22T23:30:00", arrival: "06:50", type: "flight" }
];

const MAX_WINDOW_MS = 30 * 24 * 60 * 60 * 1000;
function clamp(v, a=0, b=100){ return Math.max(a, Math.min(b, v)); }
function getColorForTimeLeft(msLeft){ if(msLeft <= 3600000) return "#27ae60"; if(msLeft <= 86400000) return "#f1c40f"; if(msLeft <= 604800000) return "#e67e22"; return "#4b6b82"; }
function formatCountdown(target, now){ const diff = target - now; if(diff <= 0) return "0 dias 0h 0m 0s";
    const s = Math.floor(diff/1000);
    const dias = Math.floor(s / 86400);
    const h = Math.floor((s % 86400) / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    return `${dias} dias ${h}h ${m}m ${sec}s`;
}

function render(){
    const now = new Date();
    const container = document.getElementById('trips-container');
    container.innerHTML = '';

    const future = TRIPS.filter(t=>new Date(t.date) > now).sort((a,b)=>new Date(a.date)-new Date(b.date));
    document.getElementById('next-destination').textContent = future.length ? `Pr√≥ximo destino: ${future[0].title} ‚Äî ${new Date(future[0].date).toLocaleString('pt-BR')}` : 'Pr√≥ximo destino: nenhuma viagem futura';

    const start = new Date(TRIPS[0].date).getTime();
    const end = new Date(TRIPS[TRIPS.length-1].date).getTime() + 7200000;
    const totalRange = end - start;
    // timelineFill foi removido conforme pedido

    const tlBar = document.getElementById('timelineBar');
    Array.from(tlBar.querySelectorAll('.tl-marker'))
    .filter(n => !['timelineStart','timelineEnd'].includes(n.id))
    .forEach(n => n.remove());
    TRIPS.forEach(t=>{
        const tMs = new Date(t.date).getTime();
        const pos = clamp(((tMs - start)/totalRange)*100, 0,100);
        const m = document.createElement('div');
        m.className = 'tl-marker';
        m.style.left = pos + '%';
        const od = getOriginDest(t.title);
        const flag = flagForUrl(od.to);
        if(flag){
            const img = document.createElement('img');
            img.src = flag;
            img.className = 'country-flag';
            img.style.marginLeft = '6px';
            m.appendChild(img);
        }
        m.appendChild(document.createTextNode(od.to));
        tlBar.appendChild(m);
    });

    for(const trip of TRIPS){
        const target = new Date(trip.date);
        const depart = trip.depart ? new Date(trip.depart) : null;
        const msLeft = target - now;

        let progressPct = 0;
        const windowStart = target.getTime() - MAX_WINDOW_MS;
        progressPct = clamp(((now.getTime() - windowStart) / MAX_WINDOW_MS) * 100, 0, 100);
        if(msLeft <= 0) progressPct = 100;
        else progressPct = clamp(((MAX_WINDOW_MS - msLeft) / MAX_WINDOW_MS) * 100, 0, 100);

        const card = document.createElement('div');
        card.className = 'trip-card';

        const color = getColorForTimeLeft(msLeft > MAX_WINDOW_MS ? MAX_WINDOW_MS : msLeft);
        const emojiLeft = `calc(${progressPct}% - 10px)`;

        let status = (()=>{
            if(trip.type === "cruise-start")
                return `Embarque previsto: ${trip.embark} ‚Äî Partida: ${new Date(trip.depart).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}`;
            if(trip.type === "cruise-end")
                return `Chegada prevista: ${trip.arrival}`;
            if(trip.type === "cruise-stop")
                return `Chegada prevista: ${target.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})} ‚Äî Partida prevista: ${new Date(trip.depart).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}`;
            if(trip.arrival)
                return `Partida prevista: ${target.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})} ‚Äî Chegada prevista: ${trip.arrival}`;
            return `Partida prevista: ${target.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}`;
        })();

        let extraMsg = "";
        if(trip.type === "flight" || trip.type === "train"){
            const departTime = new Date(trip.date);
            const arrTime = new Date(trip.date);
            if(trip.arrival){
                const [ah, am] = trip.arrival.split(":");
                arrTime.setHours(parseInt(ah), parseInt(am));
                if(arrTime < departTime) arrTime.setDate(arrTime.getDate() + 1);
            }
            if(now >= departTime - 3600000 && now < departTime)
                extraMsg = "Hora de Embarcar";
            else if(now >= departTime + 1800000 && now < arrTime + 3600000)
                extraMsg = "Embarque conclu√≠do. Boa viagem!";
            else if(now >= arrTime + 3600000)
                extraMsg = "Viagem conclu√≠da";
        }

        const odCard = getOriginDest(trip.title);
        let originFlag = flagForUrl(odCard.from);
        if(trip.type === "cruise-stop" || trip.type === "cruise-start" || trip.type === "cruise-end") originFlag = null;
        const destFlagUrl = flagForUrl(odCard.to);
        const destFlag = destFlagUrl ? `<img class='country-flag' src='${destFlagUrl}' />` : '';

        // t√≠tulo com bandeiras (origem antes, destino depois)
        card.innerHTML = `
            <div class="title-row"><h3>${
                (trip.type === "cruise-stop" || trip.type === "cruise-start" || trip.type === "cruise-end")
                ? `${odCard.to}${destFlag}`
                : `${originFlag ? `<img class='country-flag' src='${originFlag}' />` : ''}${odCard.from} ‚Üí ${odCard.to}${destFlag}`
            }</h3><div class="sub">${target.toLocaleDateString('pt-BR')}</div></div>

            <div class="progress-wrapper">
                <div class="progress-fill" style="width:${progressPct}%;background:${color};"></div>
                <div class="emoji-icon" style="left:${emojiLeft}">${trip.type === 'train' ? 'üöÜ' : trip.type.startsWith('cruise') ? 'üö¢' : '‚úàÔ∏è'}</div>
                <div class="progress-percent">${Math.round(progressPct)}%</div>
            </div>

            <div class="status">${status}</div>
            ${extraMsg ? `<div class='status' style='color:#f1c40f'>${extraMsg}</div>` : ""}
            <div class="sub" style="color:#27ae60">Faltam ${formatCountdown(target, now)}</div>
        `;

        container.appendChild(card);
    }
}

setInterval(render, 1000);
render();
</script>
</body>
</html>
